<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>关于树形插件展示中数据结构转换的算法</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="mcna" id="关于树形插件展示中数据结构转换的算法">关于树形插件展示中数据结构转换的算法</h1><p data-anchor-id="5lfm"><code>JavaScript</code> <code>Tips</code></p><p data-anchor-id="8wf4"><a href="http://mickeywang.com" target="_blank"><i class="icon-home"></i> Laughing的博客 </a> <br>
<a href="http://weibo.com/MickeyLaughing" target="_blank"><i class="icon-weibo"></i>  Laughing四儿</a>   </p><hr><p data-anchor-id="0k5r">本文目录：</p><p data-anchor-id="zrdr"><div class="toc">
<ul>
<li><a href="#关于树形插件展示中数据结构转换的算法">关于树形插件展示中数据结构转换的算法</a><ul>
<li><a href="#问题背景">问题背景</a></li>
<li><a href="#解决方案">解决方案</a><ul>
<li><a href="#二维数据结构-树状数据结构">二维数据结构 =&gt; 树状数据结构</a></li>
<li><a href="#树状数据结构-二维数据结构">树状数据结构 =&gt; 二维数据结构</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</p><hr><div class="md-section-divider"></div><h2 data-anchor-id="ers0" id="问题背景">问题背景</h2><p data-anchor-id="6uwl">在一些目录结构、机构层级等展示的场景中，我们经常会用到一些成熟的树形插件来进行轻松展示，比如ztree等。大多数插件会支持对两种数据源格式的解析，一种是通用的二维数据结构，一种是树状数据结构。对于这两种数据结构的称呼在各插件中可能不尽相同，这里依照二维结构和树状结构来称呼。举例说明如下：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="ev72"><ol class="linenums"><li class="L0"><code class="language-JavaScript"><span class="com">// 二维数据结构</span></code></li><li class="L1"><code class="language-JavaScript"><span class="pun">[{</span></code></li><li class="L2"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"总部"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span></code></li><li class="L5"><code class="language-JavaScript"><span class="pun">},</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"002"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"二级门店1"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span></code></li><li class="L9"><code class="language-JavaScript"><span class="pun">},</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"003"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"三级门店"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"002"</span></code></li><li class="L3"><code class="language-JavaScript"><span class="pun">},</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"004"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"二级门店2"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-JavaScript"><span class="pln">  </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span></code></li><li class="L7"><code class="language-JavaScript"><span class="pun">}]</span></code></li><li class="L8"><code class="language-JavaScript"></code></li><li class="L9"><code class="language-JavaScript"><span class="com">// 树状数据结构</span></code></li><li class="L0"><code class="language-JavaScript"><span class="pun">[{</span></code></li><li class="L1"><code class="language-JavaScript"><span class="pln">    </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-JavaScript"><span class="pln">    </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"总部"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-JavaScript"><span class="pln">    </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"0"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-JavaScript"><span class="pln">    </span><span class="str">"children"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[{</span></code></li><li class="L5"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"002"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"二级门店1"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"children"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[{</span></code></li><li class="L9"><code class="language-JavaScript"><span class="pln">        </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"003"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-JavaScript"><span class="pln">        </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"三级门店"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-JavaScript"><span class="pln">        </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"002"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-JavaScript"><span class="pln">        </span><span class="str">"children"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[]</span></code></li><li class="L3"><code class="language-JavaScript"><span class="pln">      </span><span class="pun">}]</span></code></li><li class="L4"><code class="language-JavaScript"><span class="pln">    </span><span class="pun">},</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"id"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"004"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"name"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"二级门店2"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"parentId"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"001"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-JavaScript"><span class="pln">      </span><span class="str">"children"</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[]</span></code></li><li class="L9"><code class="language-JavaScript"><span class="pln">    </span><span class="pun">}]</span></code></li><li class="L0"><code class="language-JavaScript"><span class="pun">}]</span></code></li></ol></pre><p data-anchor-id="sjm1">但在某些插件中，或在某些特殊场景中，我们有两种数据结构之间相互转换的需求，需要自己写一个辅助函数来完成。这里就提供两个这样的工具函数来完成数据结构的转换。</p><p data-anchor-id="o61g"><strong>Note:</strong> 要说明的是，工具函数没有经过大数据量转换测试，所以对有实时性、大量源数据转换需求的同学而言，请自行测试分析，可采取前置或异步等方案处理。由于自身技术水平的局限性，算法本身会有性能优化的空间，若有更优处理算法，还望交流分享，谢谢！<i class="icon-smile"></i></p><div class="md-section-divider"></div><h2 data-anchor-id="2whu" id="解决方案">解决方案</h2><p data-anchor-id="834w">我们来分开介绍两种数据结构之间的转换算法，每个小结中我会先贴出整个函数的代码清单，以便大家复制粘贴，然后会简要说明其中大概的逻辑思路。</p><div class="md-section-divider"></div><h3 data-anchor-id="tngv" id="二维数据结构-树状数据结构">二维数据结构 =&gt; 树状数据结构</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="6pvv"><ol class="linenums"><li class="L0"><code class="language-javaScript"><span class="com">/**</span></code></li><li class="L1"><code class="language-javaScript"><span class="com"> * 将通用的二维数据结构转换为树状数据结构</span></code></li><li class="L2"><code class="language-javaScript"><span class="com"> * @param  {String} rootParentIdValue 表示根节点的父类id值</span></code></li><li class="L3"><code class="language-javaScript"><span class="com"> * @param  {String} parentIdName      表示父类id的节点名称</span></code></li><li class="L4"><code class="language-javaScript"><span class="com"> * @param  {String} nodeIdName        表示二维结构中，每个对象主键的名称</span></code></li><li class="L5"><code class="language-javaScript"><span class="com"> * @param  {Array} listData           为二维结构的数据</span></code></li><li class="L6"><code class="language-javaScript"><span class="com"> * @return {Array}                    转换后的tree结构数据</span></code></li><li class="L7"><code class="language-javaScript"><span class="com"> */</span></code></li><li class="L8"><code class="language-javaScript"><span class="kwd">function</span><span class="pln"> listToTree</span><span class="pun">(</span><span class="pln">rootParentIdValue</span><span class="pun">,</span><span class="pln"> parentIdName</span><span class="pun">,</span><span class="pln"> nodeIdName</span><span class="pun">,</span><span class="pln"> listData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-javaScript"><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">listData </span><span class="kwd">instanceof</span><span class="pln"> </span><span class="typ">Array</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> listData</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> listData</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="pln">parentIdName</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-javaScript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> rootList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[],</span></code></li><li class="L1"><code class="language-javaScript"><span class="pln">        nodeList </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[]</span></code></li><li class="L2"><code class="language-javaScript"></code></li><li class="L3"><code class="language-javaScript"><span class="pln">    listData</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">node</span><span class="pun">,</span><span class="pln"> index</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javaScript"><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">node</span><span class="pun">[</span><span class="pln">parentIdName</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> rootParentIdValue</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-javaScript"><span class="pln">        rootList</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">node</span><span class="pun">);</span></code></li><li class="L6"><code class="language-javaScript"><span class="pln">      </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javaScript"><span class="pln">        nodeList</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">node</span><span class="pun">);</span></code></li><li class="L8"><code class="language-javaScript"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L9"><code class="language-javaScript"><span class="pln">    </span><span class="pun">});</span></code></li><li class="L0"><code class="language-javaScript"></code></li><li class="L1"><code class="language-javaScript"><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">nodeList</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> rootList</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-javaScript"><span class="pln">      childrenNodeAdd</span><span class="pun">(</span><span class="pln">rootList</span><span class="pun">,</span><span class="pln"> nodeList</span><span class="pun">);</span></code></li><li class="L3"><code class="language-javaScript"><span class="pln">      </span><span class="kwd">return</span><span class="pln"> rootList</span><span class="pun">;</span></code></li><li class="L4"><code class="language-javaScript"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">rootList</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code class="language-javaScript"><span class="pln">      </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">(</span><span class="str">"没有对应的子节点集合"</span><span class="pun">);</span></code></li><li class="L6"><code class="language-javaScript"><span class="pln">    </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javaScript"><span class="pln">      </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">(</span><span class="str">"没有对应的父类节点集合"</span><span class="pun">);</span></code></li><li class="L8"><code class="language-javaScript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-javaScript"></code></li><li class="L0"><code class="language-javaScript"><span class="pln">    </span><span class="kwd">function</span><span class="pln"> childrenNodeAdd</span><span class="pun">(</span><span class="pln">rootNodeList</span><span class="pun">,</span><span class="pln"> childrenList</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-javaScript"><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">childrenList</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span></code></li><li class="L2"><code class="language-javaScript"><span class="pln">        rootNodeList</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">rootNode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-javaScript"><span class="pln">          rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L4"><code class="language-javaScript"><span class="pln">          </span><span class="kwd">var</span><span class="pln"> childrenNodeList </span><span class="pun">=</span><span class="pln"> childrenList</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> </span></code></li><li class="L5"><code class="language-javaScript"><span class="pln">          childrenList</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">childrenNode</span><span class="pun">,</span><span class="pln"> childrenIndex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-javaScript"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">parentIdName </span><span class="kwd">in</span><span class="pln"> childrenNode </span><span class="pun">&amp;&amp;</span><span class="pln"> rootNode</span><span class="pun">[</span><span class="pln">nodeIdName</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> childrenNode</span><span class="pun">[</span><span class="pln">parentIdName</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javaScript"><span class="pln">              rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">].</span><span class="pln">push</span><span class="pun">(</span><span class="pln">childrenNode</span><span class="pun">);</span></code></li><li class="L8"><code class="language-javaScript"><span class="pln">              childrenNodeList</span><span class="pun">.</span><span class="pln">splice</span><span class="pun">(</span><span class="pln">childrenIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span></code></li><li class="L9"><code class="language-javaScript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L0"><code class="language-javaScript"><span class="pln">          </span><span class="pun">});</span></code></li><li class="L1"><code class="language-javaScript"><span class="pln">          childrenNodeAdd</span><span class="pun">(</span><span class="pln">rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">],</span><span class="pln"> childrenNodeList</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javaScript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L3"><code class="language-javaScript"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L4"><code class="language-javaScript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-javaScript"></code></li><li class="L6"><code class="language-javaScript"><span class="pln">  </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javaScript"><span class="pln">    </span><span class="kwd">throw</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">(</span><span class="str">"格式不正确，无法转换"</span><span class="pun">);</span></code></li><li class="L8"><code class="language-javaScript"><span class="pln">  </span><span class="pun">}</span></code></li><li class="L9"><code class="language-javaScript"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="7bti">此函数可通过<code>listToTree("0", "parentId", "id", sourceData)</code>调用测试，<code>sourceData</code>为文章开头给出的二维数据结构举例。</p><p data-anchor-id="v2f1">下面简要介绍一下其中逻辑，第10行是简要验证一下入参数据的合法性，然后声明了rootList和nodeList两个变量。其中rootList为顶级根节点，nodeList为其他子节点集合，第14行到20行的循环便是为两个变量赋值，之后根据两个变量的值进一步判断数据的合法性。在验证之后调用childrenNodeAdd这个内部函数，此函数之后将会被递归调用，为每一个节点添加指定名称为“children”的子节点数组。两个入参分别是rootNodeList和childrenList，代表父节点集合，和其之后的所有子节点集合。在23行第一次调用时，传入的便是顶级根节点和其之后的所有子孙节点。下面看这段带有详细注解的代码片段：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="0fpf"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="kwd">function</span><span class="pln"> childrenNodeAdd</span><span class="pun">(</span><span class="pln">rootNodeList</span><span class="pun">,</span><span class="pln"> childrenList</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">childrenList</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">//  如果没有子节点了就结束递归</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">        </span><span class="com">//遍历父节点集合，在子节点中查找其自身的子节点，并添加到对应的子节点数组中</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">        rootNodeList</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">rootNode</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">          rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">          </span><span class="kwd">var</span><span class="pln"> childrenNodeList </span><span class="pun">=</span><span class="pln"> childrenList</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">(</span><span class="lit">0</span><span class="pun">);</span><span class="pln"> </span><span class="com">//复制一个子节点数据，用于存放剩余的子节点</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">          </span><span class="com">//遍历所有子节点</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">          childrenList</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">childrenNode</span><span class="pun">,</span><span class="pln"> childrenIndex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">parentIdName in childrenNode </span><span class="pun">&amp;&amp;</span><span class="pln"> rootNode</span><span class="pun">[</span><span class="pln">nodeIdName</span><span class="pun">]</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> childrenNode</span><span class="pun">[</span><span class="pln">parentIdName</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="com">//根节点的id 等于子节点的父类id</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">              rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">].</span><span class="pln">push</span><span class="pun">(</span><span class="pln">childrenNode</span><span class="pun">);</span><span class="pln"> </span><span class="com">//添加对应节点归为子节点</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">              childrenNodeList</span><span class="pun">.</span><span class="pln">splice</span><span class="pun">(</span><span class="pln">childrenIndex</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span class="com">//在剩余子节点中剔除已经分配过的子节点</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">          </span><span class="pun">});</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">          childrenNodeAdd</span><span class="pun">(</span><span class="pln">rootNode</span><span class="pun">[</span><span class="str">"children"</span><span class="pun">],</span><span class="pln"> childrenNodeList</span><span class="pun">);</span><span class="pln"> </span><span class="com">//剩余子节点继续递归执行，每次递归一次就表示节点增加一级。</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">        </span><span class="pun">});</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre><div class="md-section-divider"></div><h3 data-anchor-id="rcv4" id="树状数据结构-二维数据结构">树状数据结构 =&gt; 二维数据结构</h3><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="k9vq"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="com">/**</span></code></li><li class="L1"><code class="language-javascript"><span class="com"> * 将树状数据结构转换为二维数据结构</span></code></li><li class="L2"><code class="language-javascript"><span class="com"> * @param  {String} childrenName 树状结构中子节点名称</span></code></li><li class="L3"><code class="language-javascript"><span class="com"> * @param  {Array} treeData     树状结构数据</span></code></li><li class="L4"><code class="language-javascript"><span class="com"> * @return {Array}              转换后的通用二维结构数据</span></code></li><li class="L5"><code class="language-javascript"><span class="com"> */</span></code></li><li class="L6"><code class="language-javascript"><span class="kwd">function</span><span class="pln"> treeToList</span><span class="pun">(</span><span class="pln">childrenName</span><span class="pun">,</span><span class="pln"> treeData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">  </span><span class="kwd">var</span><span class="pln"> listData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">  transferTreeData</span><span class="pun">(</span><span class="pln">treeData</span><span class="pun">);</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">  </span><span class="kwd">function</span><span class="pln"> transferTreeData </span><span class="pun">(</span><span class="pln">sourceData</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">     sourceData</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">node</span><span class="pun">,</span><span class="pln"> nodeIndex</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">     </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">node</span><span class="pun">[</span><span class="pln">childrenName</span><span class="pun">].</span><span class="pln">length </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">)</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">          transferTreeData</span><span class="pun">(</span><span class="pln">node</span><span class="pun">[</span><span class="pln">childrenName</span><span class="pun">]);</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">      </span><span class="kwd">delete</span><span class="pln"> node</span><span class="pun">[</span><span class="pln">childrenName</span><span class="pun">];</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">      listData</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">node</span><span class="pun">);</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">     </span><span class="pun">});</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">  </span><span class="pun">}</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">  </span><span class="kwd">return</span><span class="pln"> listData</span><span class="pun">;</span></code></li><li class="L8"><code class="language-javascript"><span class="pun">}</span></code></li></ol></pre><p data-anchor-id="fc7w">此函数可通过<code>treeToList("children", sourceData)</code>调用测试，<code>sourceData</code>为文章开头给出的树状数据结构举例。这里的逻辑比较简单就不再赘述了。</p></div>
</body>
</html>