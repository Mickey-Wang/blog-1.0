<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>node实现的网站爬虫</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="tcyb" id="node实现的网站爬虫">node实现的网站爬虫</h1><p data-anchor-id="8vbh"><code>node</code></p><p data-anchor-id="m0qc"><a href="http://mickeywang.com" target="_blank"><i class="icon-home"></i> Laughing's blog </a> <br>
<a href="https://www.zhihu.com/people/laughingHome" target="_blank"><i class="icon-user"></i>  Laughing's zhihu</a></p><hr><p data-anchor-id="2jl4">本文目录：</p><p data-anchor-id="qujs"><div class="toc"><div class="toc">
<ul>
<li><a href="#node实现的网站爬虫">node实现的网站爬虫</a><ul>
<li><a href="#目录结构">目录结构</a></li>
<li><a href="#项目启动命令">项目启动命令</a></li>
<li><a href="#项目用到的相关模块">项目用到的相关模块</a></li>
<li><a href="#开发过程中的难点或知识盲点">开发过程中的难点或知识盲点</a></li>
</ul>
</li>
</ul>
</div>
</div>
</p><hr><blockquote data-anchor-id="8i2y" class="white-blockquote">
  <p>本篇文章是node实现的网站爬虫这个项目的README.md，因为涉及一些项目开发过程中的问题和知识点的总结，所以在这里单独拿出分享一下。项目链接如下<a href="https://github.com/Mickey-Wang/crawler" target="_blank"><i class="icon-github-alt"></i>crawler</a>。</p>
</blockquote><p data-anchor-id="4jb1">项目以抓取一个<a href="http://blog.sina.com.cn/u/1776757314" target="_blank">博客网站</a>为例，并将数据保存在MySQL数据库中，可<strong>定时更新</strong>。</p><div class="md-section-divider"></div><h2 data-anchor-id="6zmo" id="目录结构">目录结构</h2><ul data-anchor-id="2ofd">
<li><strong>example</strong> 目录：本实例最终的代码</li>
<li><strong>images</strong> 目录：文章内容用到的图片</li>
<li><strong>snippets</strong> 目录：文章内容用到的代码片段</li>
<li><strong>book.md</strong> 文件：文章内容</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="6em4" id="项目启动命令">项目启动命令</h2><p data-anchor-id="spba">scripts中有两个命令： <br>
+ crawler命令为爬取网站内容到数据库 <br>
+ server命令为带有定时功能并可展示数据（localhost:3000）的服务器程序指令</p><div class="md-section-divider"></div><h2 data-anchor-id="32nm" id="项目用到的相关模块">项目用到的相关模块</h2><ul data-anchor-id="cdzb">
<li>request：使用request模块来获取网页内容</li>
<li>cheerio：是jQuery Core的子集，实现了其中绝大部分的DOM操作API，适用于服务端</li>
<li>mysql：数据持久化到MySQL的驱动</li>
<li>async：一个使用比较广泛的JS异步流程控制模块</li>
<li>debug：用于打印调试信息，可通过设置环境变量来控制开发、测试、生产的信息输出 <br>
<ul><li>可通过cross-env进行跨平台设置，cross-env DEBUG=blog:<em></em></li><em>
</em><li><em>Windows系统在命令行下执行：set DEBUG=blog:</em></li>
<li>Linux系统在命令行下执行：export DEBUG=blog:*</li></ul></li>
<li>cron：使用<a href="https://www.npmjs.com/package/cron" target="_blank">cron模块</a>来定时执行任务</li>
</ul><div class="md-section-divider"></div><h2 data-anchor-id="jkm1" id="开发过程中的难点或知识盲点">开发过程中的难点或知识盲点</h2><ol data-anchor-id="4oub">
<li>JS中<a href="http://www.w3school.com.cn/jsref/jsref_match.asp" target="_blank">match</a>与<a href="http://www.w3school.com.cn/jsref/jsref_exec_regexp.asp" target="_blank">exec</a>方法的区分  </li>
<li>npm中的cron模块的定时规则与Linux中的定时任务工具<a href="http://crontab.org/" target="_blank">crontab语法规则</a>大致相同，只是cron多了一个秒单位。具体如下：f1 f2 f3 f4 f5 f6 <br>
<ul><li>f1表示秒钟，f2表示分钟，f3表示小时，f4表示一个月份中的第几日，f5表示月份，f6表示一个星期中的第几天。</li>
<li>各部分的取值含义如下（以f1部分为例，其他部分类似）： <br>
<ul><li>当值为<em>时，表示每秒执行一次；</em></li><em>
<li>当值为a-b时，表示从第a秒到第b秒这段时间内执行一次；</li>
</em><li><em>当值为</em>/n时，表示每隔n秒执行一次；</li>
<li>当值为a-b/n时，表示从第a秒到第b秒这段时间内每隔n秒执行一次。</li></ul></li></ul></li>
<li><p>使用node内建模块child_process模块来执行文件</p>

<ul><li>child_process模块可以通过spawn()和exec()两种方法来启动一个新进程</li>
<li><p>使用spawn()启动子进程</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> child_process </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'child_process'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="com">// spawn()是直接运行文件的，而在Windows系统下dir命令是cmd.exe的内置命令</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">    </span><span class="com">// 并不实际存在名为dir.exe的可执行文件，所以这里需要判断一下</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">    </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">platform </span><span class="pun">===</span><span class="pln"> </span><span class="str">'win32'</span><span class="pun">){</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> dir </span><span class="pun">=</span><span class="pln"> child_process</span><span class="pun">.</span><span class="pln">spawn</span><span class="pun">(</span><span class="str">'cmd.exe'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'/s'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'/c'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'dir'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'c:\\'</span><span class="pun">]);</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> dir </span><span class="pun">=</span><span class="pln"> child_process</span><span class="pun">.</span><span class="pln">spawn</span><span class="pun">(</span><span class="str">'dir'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="str">'/'</span><span class="pun">]);</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-javascript"></code></li><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="com">// 当子进程有输出时，自动将其输出到当前进程的标准输出流</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    dir</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    dir</span><span class="pun">.</span><span class="pln">stderr</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">stderr</span><span class="pun">);</span></code></li><li class="L3"><code class="language-javascript"></code></li><li class="L4"><code class="language-javascript"><span class="pln">    </span><span class="com">// 进程结束时触发close事件</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">    dir</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'close'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'进程结束，代码=%d'</span><span class="pun">,</span><span class="pln"> code</span><span class="pun">);</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">    </span><span class="pun">})</span></code></li></ol></pre></li>
<li><p>使用exec()启动子进程</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> child_process </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'child_process'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="com">// 选项</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> options </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">       </span><span class="com">// 输出缓冲区的大小，默认是200KB，如果进程的输出超过这个值，会抛出异常，并结束该进程</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">       maxBuffer</span><span class="pun">:</span><span class="pln"> </span><span class="lit">200</span><span class="pun">*</span><span class="lit">1024</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">    </span><span class="pun">};</span></code></li><li class="L7"><code class="language-javascript"></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> dir </span><span class="pun">=</span><span class="pln"> child_process</span><span class="pun">.</span><span class="pln">exec</span><span class="pun">(</span><span class="str">'dir *'</span><span class="pun">,</span><span class="pln">options</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> stdout</span><span class="pun">,</span><span class="pln"> stderr</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'stdout: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> stdout</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">        console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'stderr: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> stderr</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="pun">});</span></code></li></ol></pre></li>
<li><p>spawn和exec方法的区别</p>

<ul><li>spawn执行的命令必须是一个实际存在的可执行文件，而exec执行的命令则与在命令行下执行的命令一样；</li>
<li>exec可以在回调函数中一次性返回子进程在stdout和stderr中输出的内容，但调用两者都会返回一个ChildProcess实例，通过监听其stdout和stderr属性的data事件可以获取到进程的输出；</li>
<li>exec可以指定maxBUffer参数，默认200KB，如果子进程的输出大于这个值，将会抛出Error: stdout maxBuffer exceeded异常，并结束该子进程；</li></ul></li>
<li>当执行Node.js程序时，用spawn执行node的可执行文件 <br>
<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> child_process </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'child_process'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="kwd">function</span><span class="pln"> execNodeFile </span><span class="pun">(</span><span class="pln">file</span><span class="pun">){</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">        </span><span class="kwd">var</span><span class="pln"> node </span><span class="pun">=</span><span class="pln"> spawn</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">execPath</span><span class="pun">,</span><span class="pln"> </span><span class="pun">[</span><span class="pln">file</span><span class="pun">]);</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">        node</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">stdout</span><span class="pun">);</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">        node</span><span class="pun">.</span><span class="pln">stderr</span><span class="pun">.</span><span class="pln">pipe</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">stderr</span><span class="pun">);</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">        node</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'close'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">          console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'进程结束，代码=%d'</span><span class="pun">,</span><span class="pln"> code</span><span class="pun">);</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">        </span><span class="pun">});</span><span class="pln">  </span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">    execNodeFile</span><span class="pun">(</span><span class="str">'abc.js'</span><span class="pun">)</span></code></li></ol></pre></li></ul></li>
<li><strong>处理uncaughtException事件</strong> <br>
<ul><li>大多数情况下，异步I/O操作（如本地磁盘I/O、网络I/O），所发生的错误是无法被try/catch捕获的。如果其所抛出的异常没有被捕捉到，将会导致Node.js进程直接退出。而本项目中有大量的网络I/O操作。</li>
<li>在Node.js中，如果一个抛出的异常没有被try/catch捕获到，其会尝试将这些错误交由uncaughtException事件处理程序来处理，仅当没有注册该事件处理程序时，才会最终导致进程直接退出。因此我们在app.js的末尾做了处理。</li></ul></li>
<li>使用<strong>pm2</strong>来启动程序 <br>
<ul><li>有时候，由于Node.js自身的BUg或者使用到第三方C++模块的缺陷而导致一些底层的错误，比如在Linux系统下偶尔会发生段错误（segment fault）导致程序崩溃，此时上面提到的处理uncaughtException事件的方法就不适用了。</li>
<li>pm2是一个功能强大的进程管理器，通过pm2 start来启动Node.js程序，当该进程异常退出时，pm2会自动尝试重启进程，这样可以保证Node.js应用稳定运行。同时pm2还可以很方便地查看其所启动的各个进程的内存占用和日志等信息。</li>
<li>全局安装 npm install -g pm2</li>
<li>加入要启动的程序文件是~/app.js，在命令行下执行pmw start ~/app.js即可启动程序，执行pm2 stop ~/app.js即可停止该程序。 </li></ul></li>
<li><p>对于某些使用GBK字符编码的网站，如淘宝网，因为JS内部的字符编码是使用Unicode来表示的，因此在编写爬虫来处理这些GBK编码的网页内容时还需要将其转换成UTF-8编码。</p>

<ul><li><p>比如运行下面程序来抓取一个GBK编码的网页：</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'request'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> cheerio </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'cheerio'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"></code></li><li class="L3"><code class="language-javascript"><span class="pln">    request</span><span class="pun">(</span><span class="str">'http://www.taobao.com/'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> $ </span><span class="pun">=</span><span class="pln"> cheerio</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">          </span><span class="com">// 执行后，输出内容时空白的，这是因为Node.js把GBK编码的网页内容当做Unicode编码来处理了。</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">          console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'head title'</span><span class="pun">).</span><span class="pln">text</span><span class="pun">());</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="pun">})</span></code></li></ol></pre></li>
<li><p>第一种方法可以安装iconv-lite模块</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> request </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'request'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> cheerio </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'cheerio'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> iconv </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'iconv-lite'</span><span class="pun">);</span></code></li><li class="L3"><code class="language-javascript"></code></li><li class="L4"><code class="language-javascript"><span class="pln">    request</span><span class="pun">({</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">       url</span><span class="pun">:</span><span class="pln"> </span><span class="str">'http://www.taobao.com/'</span><span class="pun">,</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">       </span><span class="com">// 注意，设置request抓取网页时不要对接收到的数据做任何编码转换</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">       encoding</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">null</span></code></li><li class="L8"><code class="language-javascript"><span class="pln">    </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L9"><code class="language-javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span></code></li><li class="L0"><code class="language-javascript"><span class="pln">      </span><span class="com">// 转换gbk编码的网页内容</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">      body </span><span class="pun">=</span><span class="pln"> iconv</span><span class="pun">.</span><span class="pln">decode</span><span class="pun">(</span><span class="pln">body</span><span class="pun">,</span><span class="pln"> </span><span class="str">'gbk'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> $ </span><span class="pun">=</span><span class="pln"> cheerio</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span></code></li><li class="L3"><code class="language-javascript"><span class="pln">          console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'head title'</span><span class="pun">).</span><span class="pln">text</span><span class="pun">());</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">    </span><span class="pun">})</span></code></li></ol></pre></li>
<li><p>第二种方法可以安装gbk模块</p>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> cheerio </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'cheerio'</span><span class="pun">);</span></code></li><li class="L1"><code class="language-javascript"><span class="pln">    </span><span class="kwd">var</span><span class="pln"> gbk </span><span class="pun">=</span><span class="pln"> require</span><span class="pun">(</span><span class="str">'gbk'</span><span class="pun">);</span></code></li><li class="L2"><code class="language-javascript"></code></li><li class="L3"><code class="language-javascript"><span class="pln">    gbk</span><span class="pun">.</span><span class="pln">fetch</span><span class="pun">(</span><span class="str">'http://www.taobao.com/'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf-8'</span><span class="pun">).</span><span class="pln">to</span><span class="pun">(</span><span class="str">'string'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-javascript"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span></code></li><li class="L5"><code class="language-javascript"><span class="pln">      </span><span class="kwd">var</span><span class="pln"> $ </span><span class="pun">=</span><span class="pln"> cheerio</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span></code></li><li class="L6"><code class="language-javascript"><span class="pln">          console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">$</span><span class="pun">(</span><span class="str">'head title'</span><span class="pun">).</span><span class="pln">text</span><span class="pun">());</span></code></li><li class="L7"><code class="language-javascript"><span class="pln">    </span><span class="pun">})</span></code></li></ol></pre></li></ul></li>
</ol></div>
</body>
</html>